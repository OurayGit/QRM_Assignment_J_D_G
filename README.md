# QRM Assignment – Credit Portfolio with Copulas

This repository contains the code and data for a Quantitative Risk Management (QRM) assignment at the University of St. Gallen (Autumn Semester 2025).

The goal is to estimate **Value-at-Risk (VaR)** and **Expected Shortfall (ES)** for the profit-and-loss distribution of a credit portfolio with 100 corporate counterparties (Switzerland and the US). We use a **latent-variable credit risk model** and compare three different specifications for the joint distribution of the market factors:

- **M1 – Empirical model:** historical joint distribution of SPI and SPX weekly returns  
- **M2 – Gaussian model:** bivariate normal factors estimated by MLE  
- **M3 – t-copula model:** Gaussian marginals with a bivariate t-copula for dependence

All figures and numerical results in the written report are generated by the R code in this repository.

---

## Repository structure

- `QRM_Assigment.R`  
  Main R script.  
  - Loads the index and credit portfolio data  
  - Computes weekly log-returns of SPI and SPX  
  - Estimates the factor models M1, M2, M3 (including MLE for the Gaussian model and t-copula)  
  - Simulates latent asset variables \(Y_k\) and default indicators  
  - Computes portfolio loss distributions  
  - Calculates VaR and ES (static and time-varying)  
  - Produces the tables and plots used in the LaTeX report

- `QRM.Rproj`  
  RStudio project file (optional, but recommended for running the analysis).

- `qrm25HSG_creditportfolio.xlsx`  
  Input dataset containing the 100 counterparties (exposures \(E_k\), recovery rates \(R_k\), rating classes, unconditional PDs \(\pi_k\), etc.).

- `qrm25HSG_indexes.xlsx`  
  Input dataset with SPI and SPX index levels used to construct weekly log-returns.

- `.github/workflows/`  
  GitHub Actions workflow used to run the R script in CI and check that the analysis is reproducible.

---

## How to run the code

### 1. Requirements

You need:

- **R** (version 4.x or later recommended)
- The following R packages:

```r
install.packages(c(
  "gmp",
  "Rmpfr",
  "copula",
  "readxl",
  "dplyr",
  "lubridate",
  "ggplot2",
  "tidyr",
  "MASS",
  "patchwork",
  "scales",
  "here"
))
